<!DOCTYPE html>

<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      /* FIZX-inspired stylesheet */
      body {
        background: #181c24;
        color: #fff; /* Use white for main text */
        font-family: "Segoe UI", Arial, sans-serif;
        margin: 0;
        padding: 0 0 0 220px;
      }

      header {
        background: #7f5af0; /* Solid purple */
        color: #fff;
        padding: 48px 0 32px 0;
        text-align: center;
        font-size: 2.2em;
        font-weight: bold;
        position: relative;
        margin-bottom: 32px;
        letter-spacing: 1px;
        border-bottom-left-radius: 32px;
        border-bottom-right-radius: 32px;
        box-shadow: 0 4px 24px rgba(127, 90, 240, 0.15);
        overflow: hidden; /* Keep bubbles inside header */
      }

      .bubble {
        position: absolute;
        bottom: 0; /* Start at the bottom of the header */
        background: rgba(44, 182, 125, 0.25);
        border-radius: 50%;
        animation: rise 10s infinite ease-in;
      }

      @keyframes rise {
        0% {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
        100% {
          transform: translateY(-120px) scale(0.5); /* Rise only within header */
          opacity: 0;
        }
      }

      #sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 200px;
        height: 100%;
        background: #22262f;
        color: #fff;
        padding: 32px 20px;
        box-shadow: 2px 0 16px rgba(44, 182, 125, 0.08);
        border-top-right-radius: 32px;
        border-bottom-right-radius: 32px;
        z-index: 10;
      }

      #sidebar h2 {
        font-size: 1.2em;
        color: #ffd803; /* Yellow for sidebar heading */
        margin-bottom: 18px;
        letter-spacing: 1px;
      }

      .collapsible {
        background: #232946;
        color: #ffd803;
        font-weight: 600;
        padding: 10px 16px;
        border: none;
        text-align: left;
        width: 100%;
        cursor: pointer;
        border-radius: 8px;
        margin-bottom: 8px;
        transition: background 0.2s;
      }

      .collapsible:hover {
        background: #2a2f3d;
      }

      .content {
        display: none;
        padding-left: 20px;
        margin-bottom: 16px;
      }

      #sidebar ul {
        list-style: none;
        padding: 0;
      }

      #sidebar ul li {
        margin-bottom: 16px;
      }

      #sidebar ul li a {
        text-decoration: none;
        color: #ffd803; /* Yellow for sidebar links */
        font-weight: 600;
        transition: color 0.2s;
        border-radius: 8px;
        padding: 4px 8px;
      }

      #sidebar ul li a:hover {
        color: #7f5af0;
        background: #232946;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        color: #ffd803; /* Yellow for headings */
        margin-top: 0;
      }

      h1 {
        font-size: 2.5em;
        margin-bottom: 18px;
      }

      h2 {
        font-size: 1.5em;
        margin-bottom: 12px;
      }

      .section {
        background: #232946;
        border-radius: 18px;
        box-shadow: 0 2px 12px rgba(127, 90, 240, 0.07);
        padding: 28px 32px;
        margin-bottom: 32px;
        margin-right: 32px;
        color: #fff; /* Ensure section text is white */
      }

      .competency {
        margin-left: 18px;
        margin-bottom: 10px;
        padding-left: 10px;
        border-left: 3px solid #ffd803; /* Yellow border */
      }

      strong {
        color: #ffd803; /* Yellow for strong text */
      }

      @media (max-width: 900px) {
        body {
          padding: 0;
        }
        #sidebar {
          position: static;
          width: 100%;
          border-radius: 0;
          box-shadow: none;
          margin-bottom: 24px;
        }
        .section {
          margin-right: 0;
          padding: 18px 8px;
        }
      }
    </style>
    <script>
      // Add any JavaScript here if needed

      function moveManagementToEnd(arr) {
        const index = arr.findIndex((item) =>
          item.toLowerCase().includes("management_table_1".toLowerCase())
        );
        if (index !== -1) {
          const [item] = arr.splice(index, 1); // Remove the matched item
          arr.push(item); // Add it to the end
        }
        return arr;
      }

      async function getJsonFilesAsObject() {
        const owner = "bmvmachado";
        const repo = "roles";
        const path = "Data";
        const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;

        try {
          const response = await fetch(apiUrl);
          const files = await response.json();

          const jsonFiles = files.filter((file) => file.name.endsWith(".json"));

          const combinedJson = {};

          for (const file of jsonFiles) {
            const fileResponse = await fetch(file.download_url);
            const fileContent = await fileResponse.json();
            combinedJson[file.name] = fileContent;
          }

          return combinedJson;
        } catch (error) {
          console.error("Failed to fetch JSON files:", error);
          return null;
        }
      }

      dataFull = "";
      getJsonFilesAsObject()
        .then((data) => {
          dataFull = data;

          // Example JSON data
          var keys = Object.keys(dataFull);

          keys = moveManagementToEnd(keys);

          keys.forEach((key) => {
            if (key.includes("table_1.json") && !key.includes("Behavioral")) {
              const button = document.createElement("button");
              button.className = "collapsible";
              button.textContent = `${key.replace("_table_1.json", "")}`;

              const content = document.createElement("div");
              content.className = "content";

              dataFull[key].forEach((entry) => {
                const li = document.createElement("li");
                li.innerHTML = `<a href="#" onclick="changeRole('${
                  entry.Level
                }', '${key.split("_")[0]}')">${entry.Level}</a>`;
                content.appendChild(li);
              });

              button.addEventListener("click", () => {
                content.style.display =
                  content.style.display === "block" ? "none" : "block";
              });
              document.getElementById("roleList").appendChild(button);
              document.getElementById("roleList").appendChild(content);
            }
          });
          //changeRole("Junior Software Engineer", "Software Engineering");
        })
        .catch((error) => {
          console.error("Error loading data:", error);
          document.getElementById("overview").innerText = "Error loading data.";
        });

      function toggleOverview() {
        document.getElementById("role").style.display = "none";
        document.getElementById("global").style.display = "block";
      }

      function changeRole(role, discipline) {
        document.getElementById("role").style.display = "block";
        document.getElementById("global").style.display = "none";

        dataFull[`${discipline}_table_1.json`]
          .filter((entry) => entry.Level === role)
          .forEach((entry) => {
            document.getElementById("title").innerText = role;
            document.getElementById("overview").innerText = entry.Overview;
            document.getElementById("experience").innerText =
              entry["Experience (Guidance)"];
            document.getElementById("scope").innerText =
              entry["Scope Of Influence"];
            document.getElementById("responsibilities").innerText =
              entry.Responsibilities;
            document.getElementById("mentorship").innerText = entry.Mentorship;
            document.getElementById("impact").innerText = entry.Impact;
          });

        const jsonDataTech = {
          Category: [],
          values: [],
        };

        const jsonDataBehavioral = {
          Category: [],
          values: [],
        };

        var jumpToBehavioral = false;
        Object.entries(
          dataFull[`${discipline} - Matrix.json`].SubAreaSkills
        ).forEach(([key, value]) => {
          level =
            dataFull[`${discipline} - Matrix.json`].SubAreaSkills[key][role];

          if (key === "Conflict Management") jumpToBehavioral = true;

          console.log(`JSON Data: key :${key} ${level}`);
          if (jumpToBehavioral) {
            jsonDataBehavioral.Category.push(key);
            if (level && level[0] === "L") {
              jsonDataBehavioral.values.push(level.slice(1));
            }
          } else {
            jsonDataTech.Category.push(key);
            if (level && level[0] === "L") {
              jsonDataTech.values.push(level.slice(1));
            }
          }
        });

        console.log("JSON DataTech:", jsonDataTech);

        console.log("JSON jsonDataBehavioral:", jsonDataBehavioral);

        if (jsonDataTech.values.length === 0) {
          document.getElementById("noTechnicalCompetencies").style.display =
            "block";
        } else {
          document.getElementById("noTechnicalCompetencies").style.display =
            "none";
          writeChart(
            "competenciesTechnicalChart",
            role,
            jsonDataTech,
            "Technical Competencies"
          );
        }

        writeChart(
          "competenciesBehavioralChart",
          role,
          jsonDataBehavioral,
          "Behavioral Competencies"
        );

        writeCompetencies(
          "competenciesTechnical",
          dataFull[`${discipline}_table_2.json`],
          jsonDataTech
        );

        writeCompetencies(
          "competenciesBehavioral",
          dataFull["Behavioral_table_1.json"],
          jsonDataBehavioral
        );
      }

      function writeCompetencies(elementId, dataFull, data) {
        const container = document.getElementById(elementId);
        container.innerHTML = ""; // Clear existing content

        Object.entries(data.Category).forEach(([key, value]) => {
          console.log("Key:", key, "Value:", value);
          const competencyLevel = dataFull.filter(
            (b) => b.Competency === value
          );
          console.log("Competency Level:", competencyLevel);
          if (competencyLevel) {
            const competencyDiv = document.createElement("div");
            competencyDiv.classList.add("competency");
            var levelValue = Number(data.values[key]);
            var description =
              competencyLevel[0][
                Object.keys(competencyLevel[0])[levelValue + 1]
              ];
            if (description) {
              competencyDiv.innerHTML = `
                      <p>
                        <strong>${competencyLevel[0].Competency} (L${levelValue}):</strong> ${description}
                      </p>
                    `;
              container.appendChild(competencyDiv);
            }
          }
        });
      }

      function writeChart(chartId, label, data, title) {
        const ctx = document.getElementById(chartId).getContext("2d");

        if (Chart.getChart(chartId)) {
          Chart.getChart(chartId)?.destroy();
        }

        const labelCount = data.Category.length;

        // Dynamically adjust canvas size based on label count
        const baseSize = 300;
        const sizeMultiplier = Math.ceil(labelCount / 5); // Adjust this factor as needed
        const canvasSize = baseSize + sizeMultiplier * 100;

        // Set canvas dimensions
        ctx.canvas.width = canvasSize;
        ctx.canvas.height = canvasSize;

        const spiderChart = new Chart(ctx, {
          type: "radar",
          data: {
            labels: data.Category,
            datasets: [
              {
                label: label,
                data: data.values,
                fill: true,
                backgroundColor: "rgba(54, 162, 235, 0.2)",
                borderColor: "rgba(54, 162, 235, 1)",
                pointBackgroundColor: "rgba(54, 162, 235, 1)",
              },
            ],
          },
          options: {
            responsive: false,
            plugins: {
              title: {
                display: true,
                text: title,
              },
            },
            scales: {
              r: {
                beginAtZero: true,
                max: 5,
              },
            },
          },
        });
      }
    </script>
  </head>
  <body>
    <header>
      <span style="font-size: 0.8em; vertical-align: middle">Welcome to</span>
      <img
        src="logo.png"
        alt="Hubexo Logo"
        style="height: 56px; vertical-align: middle; margin: 0 12px"
      />
      <span style="font-size: 0.8em; vertical-align: middle">Careers</span>

      <div
        class="bubble"
        style="width: 40px; height: 40px; left: 10%; animation-delay: 0s"
      ></div>
      <div
        class="bubble"
        style="width: 25px; height: 25px; left: 30%; animation-delay: 2s"
      ></div>
      <div
        class="bubble"
        style="width: 50px; height: 50px; left: 50%; animation-delay: 4s"
      ></div>
      <div
        class="bubble"
        style="width: 30px; height: 30px; left: 70%; animation-delay: 1s"
      ></div>
      <div
        class="bubble"
        style="width: 20px; height: 20px; left: 90%; animation-delay: 3s"
      ></div>
    </header>
    <div id="sidebar">
      <h2></h2>
      <ul>
        <button onclick="toggleOverview()" class="collapsible">Overview</button>
      </ul>
      <ul id="roleList"></ul>
    </div>
    <div id="global" class="section">
      <img src="Global.png" alt="Role Image" style="display: block" />
    </div>
    <div id="role" class="section" style="display: none">
      <div class="section">
        <h1 id="title"></h1>
        <p></p>
        <h2>Overview</h2>
        <p id="overview"></p>
        <p />
        <p><strong>Experience:</strong> <span id="experience"></span></p>
        <p><strong>Scope Of Influence:</strong> <span id="scope"></span></p>
        <p>
          <strong>Responsibilities:</strong> <span id="responsibilities"></span>
        </p>
        <p><strong>Mentorship:</strong> <span id="mentorship"></span></p>
        <p><strong>Impact:</strong> <span id="impact"></span></p>
      </div>
      <div class="section">
        <h2>Technical Competencies</h2>
        <div style="padding-left: 5%">
          <canvas id="competenciesTechnicalChart"></canvas>
        </div>

        <div id="competenciesTechnical"></div>
        <div id="noTechnicalCompetencies" style="display: none">
          <p>Based on the previous role</p>
        </div>
      </div>
      <div class="section">
        <h2>Behavioral Competencies</h2>
        <div style="padding-left: 5%">
          <canvas id="competenciesBehavioralChart"></canvas>
        </div>
        <div id="competenciesBehavioral"></div>
      </div>
    </div>
  </body>
</html>
